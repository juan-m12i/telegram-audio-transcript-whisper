Added AGENTS.md instructions and updated .gitignore
Added acknowledgment message before transcription
Fixed malformed summary prompt in gpt_whisper_bot
Added architecture review
Implemented timestamp storage in Notion logs for notes, transcripts, and summaries
Pinned dependency versions (including pytz) to stabilize docker bots
Fixed PR review issues: removed double timestamps, fixed zero value handling, added chunking for long transcripts/summaries
Created deploy-vps.sh script following three-folder pattern for VPS deployment
Fixed PR review bugs: corrected sentence rejoining to use spaces instead of newlines, added validation to prevent chunks exceeding max_chunk_size limit
2025-11-14 10:28:07 - Updated timestamp handling to use Argentina timezone (America/Argentina/Buenos_Aires) instead of UTC. Added timezone conversion functions with zoneinfo/pytz fallback support.
2025-11-14 10:30:43 - Refactored timezone handling to use configurable timezone with sensible default (Argentina/GMT-3). Moved common timezone functions to bot/bot_common.py. Timezone can be overridden via TIMEZONE environment variable.
2025-11-14 10:33:47 - Resolved merge conflicts by merging dev into main. Conflicts were in agent.log and gpt_whisper_bot.py - resolved cleanly with all changes from both branches preserved.
2025-01-XX XX:XX:XX - Fixed timezone handling: Added fallback to pytz when ZoneInfo fails due to missing tzdata database (e.g., on Alpine Linux). Catches ZoneInfoNotFoundError and KeyError to ensure bots work on minimal Python environments.
2025-11-14 13:54:06 - Fixed FileNotFoundError when downloading audio files: Added os.makedirs('audio_files', exist_ok=True) to ensure directory exists before writing files in Docker container.
2025-11-14 13:54:06 - Renamed deploy-vps-deploy.sh to deploy-vps.sh for better naming consistency.
2025-01-15 XX:XX:XX - Implemented storage adapter pattern for abstracting note storage backends. Created StorageAdapter abstract base class, refactored NotionAdapter to implement it (backward compatible), added ApiAdapter for HTTP API storage with idempotent POST endpoint. Created workout_bot.py with support for both new messages and message edits. API handles create/update logic based on message_id, uses Bearer token auth and composite chat_id+message_id identifiers.
2025-11-16 XX:XX:XX - Updated workout_bot to use message reactions instead of reply messages. Upgraded python-telegram-bot from 20.2 to 22.5 for reaction support. Bot now reacts with ðŸ‘ for new notes and â¤ï¸ for updated notes. Fixed env file loading order to ensure workout_bot.env is loaded before bot_common imports. Added logic to clear previous reactions before setting new ones on message edits.
2025-01-XX XX:XX:XX - Fixed httpx dependency conflict: Updated httpx from 0.25.2 to >=0.27,<0.29 to satisfy python-telegram-bot 22.x requirements while maintaining compatibility with notion-client 2.0.0.
2025-11-17 XX:XX:XX - Fixed workout bot network connectivity: Added workout_bot to docker-services-network in docker_compose.yml and updated NOTES_API_URL from localhost to data-manager container name for proper Docker service discovery. Deployed to VPS - workout_bot container now on docker-services-network and can connect to data-manager API.
2025-11-17 13:21:06 - Audited repo for exposed secrets and deployment risks; no secrets found, noted third-party data handling and infra disclosures.
2025-11-17 XX:XX:XX - Fixed workout bot network connectivity: Added workout_bot to docker-services-network in docker_compose.yml and updated NOTES_API_URL from localhost to data-manager container name for proper Docker service discovery. Deployed to VPS - workout_bot container now on docker-services-network and can connect to data-manager API. Removed conflicting whisper bot container and recreated all containers successfully. Updated deploy-vps.sh to include workout_bot.env in environment file checks and cont-telegram-workout-bot in container verification. Updated docker_compose_recreate.sh to handle network cleanup gracefully without suppressing errors.
2025-11-17 XX:XX:XX - Implemented log sanitization for Telegram bot API tokens: Created TokenSanitizingFilter class in bot_common.py that obfuscates bot tokens in httpx/httpcore logs using fingerprint format (first 4 + last 4 chars) matching bot_lookup.py pattern. Filter applied to httpx and httpcore loggers globally. Tokens in URLs like "bot5863831530:AAGwypCaB7Zux6S7LeepCTWjYqWJOG1vl6Y" are now sanitized to "bot5863831530:5863..vl6Y (Notes)" format.
2025-11-17 10:39:22 - Fixed PR review issue in TokenSanitizingFilter: Added record.args = () to clear args when replacing record.msg with already-formatted sanitized message, preventing TypeError from double-formatting when handlers try to apply args to formatted message.
2025-11-17 13:36:XX - Reduced log verbosity: Set httpx, httpcore, and telegram loggers to WARNING level to prevent spam from HTTP request logs. Fixed TokenSanitizingFilter formatting error by sanitizing message components before formatting instead of after, preventing "TypeError: not all arguments converted during string formatting" errors.
